<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Actor Identifier</title>
  <style>
    :root{--bg:#0f172a;--fg:#f8fafc;--accent:#3b82f6;--danger:#ef4444;--success:#10b981;}
    *,*:before,*:after{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--fg);font-family:system-ui,sans-serif;display:flex;align-items:center;justify-content:center;touch-action:none}

    .screen{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2vh;padding:2vh;background:var(--bg)}
    .hidden{display:none!important}
    h1,h2{font-size:8vw;font-weight:700;text-align:center;line-height:1.1}
    p{font-size:4.5vw;text-align:center}
    button{border:none;border-radius:12px;background:var(--accent);color:#fff;font-size:5vw;font-weight:600;padding:.6em 1.4em;cursor:pointer;min-width:40vw}
    button.secondary{background:#475569}
    button.alt{background:#334155}

    video,img{width:80vmin;height:80vmin;max-width:90vw;max-height:90vw;border-radius:12px;object-fit:cover;border:3px dashed var(--accent)}
    #preview{border:3px solid var(--accent)}

    .badge{width:25vmin;height:25vmin;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12vw;font-weight:700;color:#fff;margin-bottom:2vh}
    .success{background:var(--success)}
    .error{background:var(--danger)}

    .answers{display:flex;flex-direction:column;gap:2vh;width:100%;align-items:center}
  </style>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@aws-sdk/client-rekognition/+esm"></script>
</head>
<body>
  <!-- Screen 1: live camera -->
  <section id="s1" class="screen">
    <h1>Point at the TV</h1>
    <p>Pinch to zoom<br>Tap to snap</p>
    <video id="video" playsinline muted autoplay></video>
  </section>

  <!-- Screen 2: review -->
  <section id="s2" class="screen hidden">
    <h1>Identify an actor</h1>
    <img id="preview" alt="snapshot" />
    <div style="display:flex;gap:4vw">
      <button id="retakeBtn" class="secondary">Retake</button>
      <button id="identifyBtn">Identify</button>
    </div>
  </section>

  <!-- Screen 3A: failed -->
  <section id="s3fail" class="screen hidden">
    <div class="badge error">‚úó</div>
    <h2>FAILED<br>TRY AGAIN</h2>
    <button id="failAgainBtn">üì∑ Try again</button>
  </section>

  <!-- Screen 3B: success suspense -->
  <section id="s3succ" class="screen hidden">
    <div class="badge success">‚úì</div>
    <h2>I KNOW WHO<br>THIS IS!</h2>
    <div style="display:flex;gap:4vw">
      <button id="quizBtn">üß© Quiz</button>
      <button id="revealBtn" class="secondary">üìñ Reveal</button>
    </div>
  </section>

  <!-- Screen 4: quiz -->
  <section id="s4quiz" class="screen hidden">
    <h2 id="quizQuestion">This actor appeared in:</h2>
    <div id="answers" class="answers"></div>
    <button id="quizBack" class="alt">‚Üê Back</button>
  </section>

  <!-- Screen 5: quiz correct -->
  <section id="s5correct" class="screen hidden">
    <div class="badge success">‚úì</div>
    <h2>CORRECT!</h2>
    <div style="display:flex;gap:4vw">
      <button id="viewImdbBtn">üîé Google</button>
      <button id="newQuizBtn" class="secondary">üîÑ New quiz</button>
    </div>
  </section>

  <!-- Screen 6: quiz wrong -->
  <section id="s6wrong" class="screen hidden">
    <div class="badge error">‚úó</div>
    <h2>TRY AGAIN?</h2>
    <div style="display:flex;gap:4vw">
      <button id="wrongAgainBtn">üîÑ New quiz</button>
      <button id="viewImdbBtn2" class="secondary">üîé Google</button>
    </div>
  </section>

  <!-- Screen 7: reveal -->
  <section id="s7reveal" class="screen hidden">
    <h2 id="revealName">Actor</h2>
    <p>Popular shows:</p>
    <ul id="showList" style="list-style:none;font-size:4vw"></ul>
    <div style="display:flex;gap:4vw">
      <button id="viewImdbBtn3">üîé Google</button>
      <button id="homeBtn" class="secondary">üè† Home</button>
    </div>
  </section>

  <canvas id="snapCanvas" class="hidden"></canvas>

  <script type="module">
    import { RekognitionClient, RecognizeCelebritiesCommand } from "https://cdn.jsdelivr.net/npm/@aws-sdk/client-rekognition/+esm";
    const rekognition=new RekognitionClient({region:"us-east-1",credentials:{accessKeyId:"AKIAUKQE2T34QL66ITWW",secretAccessKey:"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"}});
    const TMDB_KEY='37c64e6294a4e977bc4ecae3de479917';

    const ids=id=>document.getElementById(id);
    const video=ids('video'),preview=ids('preview'),canvas=ids('snapCanvas');
    const quizQ=ids('quizQuestion'),answersBox=ids('answers');
    const revealName=ids('revealName'),showList=ids('showList');
    const screens=['s1','s2','s3fail','s3succ','s4quiz','s5correct','s6wrong','s7reveal'];
    const show= id=>screens.forEach(s=>ids(s).classList.toggle('hidden',s!==id));

    let snapshotBlob,actorName,correctShow;

    /* Camera */
    (async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});video.srcObject=stream;await video.play();}catch(e){console.error(e)}})();

    /* Zoom */
    let baseScale=1,pinchStart=0,currentScale=1;const active=[];const dist=(a,b)=>Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
    video.addEventListener('pointerdown',e=>{active.push(e);video.setPointerCapture(e.pointerId);if(active.length===2)pinchStart=dist(...active)});
    video.addEventListener('pointermove',e=>{const i=active.findIndex(p=>p.pointerId===e.pointerId);if(i>-1)active[i]=e;if(active.length===2){const d=dist(...active);currentScale=Math.min(3,Math.max(1,baseScale*d/pinchStart));video.style.transform=`scale(${currentScale})`}});
    video.addEventListener('pointerup',e=>{const i=active.findIndex(p=>p.pointerId===e.pointerId);if(i>-1)active.splice(i,1);if(active.length<2)baseScale=currentScale});

    /* Snap */
    ids('s1').addEventListener('click',async()=>{const w=video.videoWidth||640,h=video.videoHeight||480;canvas.width=w;canvas.height=h;canvas.getContext('2d').drawImage(video,0,0,w,h);snapshotBlob=await new Promise(r=>canvas.toBlob(b=>r(b),'image/jpeg',0.85));preview.src=URL.createObjectURL(snapshotBlob);show('s2');});
    ids('retakeBtn').onclick=()=>show('s1');

    /* Identify */
    ids('identifyBtn').onclick=async()=>{show('s3succ');try{const bytes=new Uint8Array(await snapshotBlob.arrayBuffer());const {CelebrityFaces=[]}=await rekognition.send(new RecognizeCelebritiesCommand({Image:{Bytes:bytes}}));if(!CelebrityFaces.length){show('s3fail');return;}actorName=CelebrityFaces[0].Name;show('s3succ');}catch(e){console.error(e);show('s3fail');}};
    ids('failAgainBtn').onclick=()=>show('s1');

    /* Success options */
    ids('quizBtn').onclick=async()=>{await buildQuiz();show('s4quiz');};
    ids('revealBtn').onclick=async()=>{await buildReveal();show('s7reveal');};

    /* Quiz nav */
    ids('quizBack').onclick=()=>show('s3succ');
    ids('newQuizBtn').onclick=()=>{buildQuiz();show('s4quiz');};
    ids('wrongAgainBtn').onclick=()=>{buildQuiz();show('s4quiz');};

    /* Home button */
    ids('homeBtn').onclick=()=>show('s1');

    /* Google search buttons */
    const openSearch=()=>{if(actorName)window.open(`https://www.google.com/search?q=${encodeURIComponent(actorName)}`,'_blank');};
    ids('viewImdbBtn').onclick=openSearch;ids('viewImdbBtn2').onclick=openSearch;ids('viewImdbBtn3').onclick=openSearch;

    /* Build quiz */
    async function buildQuiz(){quizQ.textContent=`${actorName} appeared in:`;answersBox.innerHTML='Loading‚Ä¶';try{const p=await fetch(`https://api.themoviedb.org/3/search/person?api_key=${TMDB_KEY}&query=${encodeURIComponent(actorName)}`);const pj=await p.json();const pid=pj.results?.[0]?.id;if(!pid)throw 0;const tv=await fetch(`https://api.themoviedb.org/3/person/${pid}/tv_credits?api_key=${TMDB_KEY}`);const tvj=await tv.json();const shows=tvj.cast.sort((a,b)=>(b.popularity||0)-(a.popularity||0)).slice(0,4);const tops=shows.map(s=>s.name);correctShow=tops[0];const wrongPool=['Friends','Breaking Bad','Lost','The Office','GoT','House MD'];const wrong=[];while(wrong.length<2){const w=wrongPool[Math.random()*wrongPool.length|0];if(!tops.includes(w)&&!wrong.includes(w))wrong.push(w);}const opts=[correctShow,tops[1]||wrong[0],...wrong].sort(()=>Math.random()-.5);answersBox.innerHTML='';opts.forEach(o=>{const b=document.createElement('button');b.textContent=o;b.onclick=()=>selectAnswer(o);answersBox.appendChild(b);});}catch(e){answersBox.textContent='Quiz error';}}
    function selectAnswer(c){c===correctShow?show('s5correct'):show('s6wrong');}

    /* Build reveal */
    async function buildReveal(){revealName.textContent=actorName;showList.innerHTML='Loading‚Ä¶';try{const p=await fetch(`https://api.themoviedb.org/3/search/person?api_key=${TMDB_KEY}&query=${encodeURIComponent(actorName)}`);const pj=await p.json();const pid=pj.results?.[0]?.id;if(!pid)throw 0;const tv=await fetch(`https://api.themoviedb.org/3/person/${pid}/tv_credits?api_key
