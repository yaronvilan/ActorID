<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Actor Identifier</title>
  <style>
    :root{
      --bg:#0f172a;--fg:#f8fafc;--accent:#3b82f6;--danger:#ef4444;--success:#10b981;
    }
    *,*:before,*:after{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--fg);
              font-family:system-ui,sans-serif;display:flex;align-items:center;justify-content:center;touch-action:none}

    .screen{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2vh;padding:2vh;background:var(--bg)}
    .hidden{display:none!important}
    h1,h2{font-size:8vw;font-weight:700;text-align:center;line-height:1.1}
    p{font-size:4.5vw;text-align:center}
    button{border:none;border-radius:12px;background:var(--accent);color:#fff;font-size:5vw;font-weight:600;padding:.6em 1.4em;cursor:pointer;min-width:40vw}
    button.secondary{background:#475569}
    button.alt{background:#334155}

    video,img{width:80vmin;height:80vmin;max-width:90vw;max-height:90vw;border-radius:12px;object-fit:cover;border:3px dashed var(--accent)}
    #preview{border:3px solid var(--accent)}

    .badge{width:25vmin;height:25vmin;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12vw;font-weight:700;color:#fff;margin-bottom:2vh}
    .success{background:var(--success)}
    .error{background:var(--danger)}

    .answers{display:flex;flex-direction:column;gap:2vh;width:100%;align-items:center}
  </style>
  <!-- AWS SDK v3 -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/@aws-sdk/client-rekognition/+esm"></script>
</head>
<body>
  <!-- Screen 1 ‚Üí live camera -->
  <section id="s1" class="screen">
    <h1>Point at the TV</h1>
    <p>Pinch to zoom<br>Tap to snap</p>
    <video id="video" playsinline muted autoplay></video>
  </section>

  <!-- Screen 2 ‚Üí review -->
  <section id="s2" class="screen hidden">
    <h1>Identify an actor</h1>
    <img id="preview" alt="snapshot"/>
    <div style="display:flex;gap:4vw">
      <button id="retakeBtn" class="secondary">Retake</button>
      <button id="identifyBtn">Identify</button>
    </div>
  </section>

  <!-- Screen 3A ‚Üí FAILED -->
  <section id="s3fail" class="screen hidden">
    <div class="badge error">‚úó</div>
    <h2>FAILED<br>TRY AGAIN</h2>
    <button id="failAgainBtn">üì∑ Try again</button>
  </section>

  <!-- Screen 3B ‚Üí SUCCESS suspense -->
  <section id="s3succ" class="screen hidden">
    <div class="badge success">‚úì</div>
    <h2>I KNOW WHO<br>THIS IS!</h2>
    <div style="display:flex;gap:4vw">
      <button id="quizBtn">üß© Quiz</button>
      <button id="revealBtn" class="secondary">üìñ Reveal</button>
    </div>
  </section>

  <!-- Screen 4 ‚Üí Quiz -->
  <section id="s4quiz" class="screen hidden">
    <h2 id="quizQuestion">This actor appeared in:</h2>
    <div id="answers" class="answers"></div>
    <button id="quizBack" class="alt">‚Üê Back</button>
  </section>

  <!-- Screen 5 ‚Üí Quiz correct -->
  <section id="s5correct" class="screen hidden">
    <div class="badge success">‚úì</div>
    <h2>CORRECT!</h2>
    <div style="display:flex;gap:4vw">
      <button id="viewImdbBtn">üì∫ View IMDB</button>
      <button id="newQuizBtn" class="secondary">üîÑ New quiz</button>
    </div>
  </section>

  <!-- Screen 6 ‚Üí Quiz wrong -->
  <section id="s6wrong" class="screen hidden">
    <div class="badge error">‚úó</div>
    <h2>TRY AGAIN?</h2>
    <div style="display:flex;gap:4vw">
      <button id="wrongAgainBtn">üîÑ New quiz</button>
      <button id="viewImdbBtn2" class="secondary">üì∫ View IMDB</button>
    </div>
  </section>

  <!-- Screen 7 ‚Üí Reveal -->
  <section id="s7reveal" class="screen hidden">
    <h2 id="revealName">Actor</h2>
    <p>Popular shows:</p>
    <ul id="showList" style="list-style:none;font-size:4vw"></ul>
    <div style="display:flex;gap:4vw">
      <button id="viewImdbBtn3">üì∫ View IMDB</button>
      <button id="revealBack" class="secondary">‚Üê Back</button>
    </div>
  </section>

  <canvas id="snapCanvas" class="hidden"></canvas>

  <script type="module">
    import { RekognitionClient, RecognizeCelebritiesCommand } from "https://cdn.jsdelivr.net/npm/@aws-sdk/client-rekognition/+esm";

    /* AWS creds */
    const rekognition = new RekognitionClient({
      region:"us-east-1",
      credentials:{accessKeyId:"AKIAUKQE2T34QL66ITWW",secretAccessKey:"lNlewkTQl1Jm9bp9NT5f95nRmFE41vyYOF/GnWV8"}
    });

    /* TMDB key placeholder */
    const TMDB_KEY = 'YOUR_TMDB_API_KEY';

    /* Element refs */
    const ids = id=>document.getElementById(id);
    const video=ids('video'),preview=ids('preview'),canvas=ids('snapCanvas');
    const indicatorSucc=ids('s3succ'),indicatorFail=ids('s3fail');
    const quizQ=ids('quizQuestion'),answersBox=ids('answers');
    const revealName=ids('revealName'),showList=ids('showList');

    const screens=['s1','s2','s3fail','s3succ','s4quiz','s5correct','s6wrong','s7reveal'];
    const show= id => screens.forEach(s=>ids(s).classList.toggle('hidden',s!==id));

    let snapshotBlob,actorName,actorImdbId,correctShow; // state

    /* open rear camera */
    (async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});video.srcObject=stream;await video.play();}catch(e){console.error('cam',e)}})();

    /* pinch-zoom */
    let baseScale=1,pinchStart=0,currentScale=1;const active=[];
    const dist=(a,b)=>Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
    video.addEventListener('pointerdown',e=>{active.push(e);video.setPointerCapture(e.pointerId);if(active.length===2)pinchStart=dist(...active)});
    video.addEventListener('pointermove',e=>{const i=active.findIndex(p=>p.pointerId===e.pointerId);if(i>-1)active[i]=e;if(active.length===2){const d=dist(...active);currentScale=Math.min(3,Math.max(1,baseScale*d/pinchStart));video.style.transform=`scale(${currentScale})`} });
    video.addEventListener('pointerup',e=>{const i=active.findIndex(p=>p.pointerId===e.pointerId);if(i>-1)active.splice(i,1);if(active.length<2)baseScale=currentScale});

    /* snap */
    ids('s1').addEventListener('click',async()=>{
      const w=video.videoWidth||640,h=video.videoHeight||480;canvas.width=w;canvas.height=h;
      canvas.getContext('2d').drawImage(video,0,0,w,h);
      snapshotBlob=await new Promise(res=>canvas.toBlob(b=>res(b),'image/jpeg',0.85));
      preview.src=URL.createObjectURL(snapshotBlob);
      show('s2');
    });

    ids('retakeBtn').onclick=()=>show('s1');

    /* identify */
    ids('identifyBtn').onclick=async()=>{
      // simple inline indication
      show('s3succ'); // placeholder until result
      try{
        const bytes=new Uint8Array(await snapshotBlob.arrayBuffer());
        const {CelebrityFaces=[]}=await rekognition.send(new RecognizeCelebritiesCommand({Image:{Bytes:bytes}}));
        if(!CelebrityFaces.length){show('s3fail');return;}
        const celeb=CelebrityFaces[0];
        actorName=celeb.Name;
        actorImdbId=celeb.Id;
        show('s3succ');
      }catch(e){console.error(e);show('s3fail');}
    };

    /* fail try again */
    ids('failAgainBtn').onclick=()=>show('s1');

    /* success choice */
    ids('quizBtn').onclick=async()=>{await buildQuiz();show('s4quiz');};
    ids('revealBtn').onclick=async()=>{await buildReveal();show('s7reveal');};

    /* quiz back */
    ids('quizBack').onclick=()=>show('s3succ');

    /* reveal back */
    ids('revealBack').onclick=()=>show('s3succ');

    /* correct/wrong handling */
    ids('newQuizBtn').onclick=()=>{buildQuiz();show('s4quiz');};
    ids('wrongAgainBtn').onclick=()=>{buildQuiz();show('s4quiz');};

    /* view imdb links */
    const toImdb=id=>window.open(`https://www.imdb.com/name/${id}/`,'_blank');
    ids('viewImdbBtn').onclick=()=>toImdb(actorImdbId);
    ids('viewImdbBtn2').onclick=()=>toImdb(actorImdbId);
    ids('viewImdbBtn3').onclick=()=>toImdb(actorImdbId);

    /* build quiz */
    async function buildQuiz(){
      quizQ.textContent=`${actorName} appeared in:`;
      answersBox.innerHTML='Loading‚Ä¶';
      try{
        // TMDB search
        const search=await fetch(`https://api.themoviedb.org/3/search/person?api_key=${TMDB_KEY}&query=${encodeURIComponent(actorName)}`);
        const searchJson=await search.json();
        const personId=searchJson.results?.[0]?.id;
        if(!personId) throw new Error('not found');
        const tv=await fetch(`https://api.themoviedb.org/3/person/${personId}/tv_credits?api_key=${TMDB_KEY}`);
        const tvJson=await tv.json();
        const shows=tvJson.cast.sort((a,b)=>(b.popularity||0)-(a.popularity||0)).slice(0,4);
        const topShows=shows.map(s=>s.name);
        correctShow=topShows[0];
        const wrongPool=['Friends','Breaking Bad','The Office','Lost','Game of Thrones','House MD'];
        const wrong=[];while(wrong.length<2){const w=wrongPool[Math.random()*wrongPool.length|0];if(!topShows.includes(w)&&!wrong.includes(w))wrong.push(w);}        
        const opts=[correctShow,topShows[1]||wrong[0],...wrong].sort(()=>Math.random()-.5);
        answersBox.innerHTML='';
        opts.forEach(o=>{const b=document.createElement('button');b.textContent=o;b.onclick=()=>selectAnswer(o);answersBox.appendChild(b);});
      }catch(err){answersBox.textContent='Quiz error';console.error(err);}
    }

    function selectAnswer(choice){
      if(choice===correctShow){show('s5correct');}else{show('s6wrong');}
    }

    /* build reveal */
    async function buildReveal(){
      revealName.textContent=actorName;
      showList.innerHTML='Loading‚Ä¶';
      try{
        const search=await fetch(`https://api.themoviedb.org/3/search/person?api_key=${TMDB_KEY}&query=${encodeURIComponent(actorName)}`);
        const pj=await search.json();
        const pid=pj.results?.[0]?.id;
        if(!pid) throw new Error('no id');
        const tv=await fetch(`https://api.themoviedb.org/3/person/${pid}/tv_credits?api_key=${TMDB_KEY}`);
        const tvj=await tv.json();
        const shows=tvj.cast.sort((a,b)=>(b.popularity||0)-(a.popularity||0)).slice(0,4);
        showList.innerHTML='';
        shows.forEach(s=>{const li=document.createElement('li');li.textContent='‚Ä¢ '+s.name;showList.appendChild(li);});
      }catch(e){showList.textContent='Could not load';console.error(e);} }
  </script>
</body>
</html>
